# Apache Virtual Host Configuration for test.first-calc.com
# Place this file in /etc/apache2/sites-available/
# Then enable it with: a2ensite test.first-calc.com.conf
# Reload Apache: systemctl reload apache2

<VirtualHost *:80>
	ServerName test.first-calc.com
	ServerAlias www.test.first-calc.com
	
	# Proxy all requests to Docker container on port 3003
	ProxyPreserveHost On
	ProxyPass / http://localhost:3003/
	ProxyPassReverse / http://localhost:3003/
	
	# WebSocket support (if needed)
	RewriteEngine On
	RewriteCond %{HTTP:Upgrade} =websocket [NC]
	RewriteRule /(.*) ws://localhost:3003/$1 [P,L]
	RewriteCond %{HTTP:Upgrade} !=websocket [NC]
	RewriteRule /(.*) http://localhost:3003/$1 [P,L]
	
	# Logging
	ErrorLog ${APACHE_LOG_DIR}/test.first-calc.com_error.log
	CustomLog ${APACHE_LOG_DIR}/test.first-calc.com_access.log combined
	
	# Security headers
	Header always set X-Content-Type-Options "nosniff"
	Header always set X-Frame-Options "SAMEORIGIN"
	Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>

# SSL Configuration (uncomment and configure when SSL certificate is available)
# <VirtualHost *:443>
# 	ServerName test.first-calc.com
# 	ServerAlias www.test.first-calc.com
# 	
# 	# SSL Configuration
# 	SSLEngine on
# 	SSLCertificateFile /etc/letsencrypt/live/test.first-calc.com/fullchain.pem
# 	SSLCertificateKeyFile /etc/letsencrypt/live/test.first-calc.com/privkey.pem
# 	Include /etc/letsencrypt/options-ssl-apache.conf
# 	
# 	# Proxy all requests to Docker container on port 3003
# 	ProxyPreserveHost On
# 	ProxyPass / http://localhost:3003/
# 	ProxyPassReverse / http://localhost:3003/
# 	
# 	# WebSocket support (if needed)
# 	RewriteEngine On
# 	RewriteCond %{HTTP:Upgrade} =websocket [NC]
# 	RewriteRule /(.*) ws://localhost:3003/$1 [P,L]
# 	RewriteCond %{HTTP:Upgrade} !=websocket [NC]
# 	RewriteRule /(.*) http://localhost:3003/$1 [P,L]
# 	
# 	# Logging
# 	ErrorLog ${APACHE_LOG_DIR}/test.first-calc.com_ssl_error.log
# 	CustomLog ${APACHE_LOG_DIR}/test.first-calc.com_ssl_access.log combined
# 	
# 	# Security headers
# 	Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
# 	Header always set X-Content-Type-Options "nosniff"
# 	Header always set X-Frame-Options "SAMEORIGIN"
# 	Header always set X-XSS-Protection "1; mode=block"
# </VirtualHost>

